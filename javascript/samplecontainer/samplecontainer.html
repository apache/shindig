<html>
<head>
<title>Gadget testing container</title>
<link rel="stylesheet" href="../container/gadgets.css">
<style type="text/css">
  body {
    font-family: arial, sans-serif;
  }

  #headerDiv {
    padding: 10px;
    margin-bottom: 20px;
    background-color: #e5ecf9;
    color: #3366cc;
    font-size: larger;
    font-weight: bold;
  }

  .subTitle {
    font-size: smaller;
    float: right;
  }

</style>
<script type="text/javascript" src="../../js/rpc.js?c=1"></script>
<script type="text/javascript" src="../container/cookies.js"></script>
<script type="text/javascript" src="../container/gadgets.js"></script>
<script type="text/javascript">

var parentUrl = document.location.href;
var baseUrl = parentUrl.substring(0, parentUrl.indexOf('samplecontainer.html'))

var gadgetUrl = baseUrl + 'examples/SocialHelloWorld.xml';
var gadgetUrlCookie = 'sampleContainerGadgetUrl';

var stateFileUrl = baseUrl + 'state-basicfriendlist.xml';
var stateFileUrlCookie = 'sampleContainerStateFileUrl';

var useCaja = false;
var useCache = true;
var usePermissive = false;
var doEvil = false;  // TODO: make evilness work.
var gadget;

// TODO: Should be able to dump the state somehow

function initGadget() {
  // Fetch cookies
  var cookieGadgetUrl = decodeURIComponent(goog.net.cookies.get(gadgetUrlCookie));
  if (cookieGadgetUrl && cookieGadgetUrl != "undefined") {
    gadgetUrl = cookieGadgetUrl;
  }

  var cookieStateFileUrl = decodeURIComponent(goog.net.cookies.get(stateFileUrlCookie));
  if (cookieStateFileUrl && cookieStateFileUrl != "undefined") {
    stateFileUrl = cookieStateFileUrl;
  }

  // Pass state file to server
  document.getElementById("stateFileUrl").value = stateFileUrl;
  // TODO: Pass the state file to the server

  // Render gadget
  document.getElementById("gadgetUrl").value = gadgetUrl;

  gadget = gadgets.container.createGadget({'specUrl': gadgetUrl});;
  gadget.setServerBase('../../');

  gadgets.container.addGadget(gadget);
  gadgets.container.layoutManager.setGadgetChromeIds(['gadget-chrome']);
  gadgets.container.renderGadgets();
};

function changeGadgetUrl() {
  useCaja = document.getElementById("useCajaCheckbox").checked;
  useCache = document.getElementById("useCacheCheckbox").checked;
  usePermissive = document.getElementById("usePermissiveCheckbox").checked;
  doEvil = document.getElementById("doEvilCheckbox").checked;

  stateFileUrl = document.getElementById("stateFileUrl").value;
  // TODO: reset the state file
  goog.net.cookies.set(stateFileUrlCookie, encodeURIComponent(stateFileUrl));

  gadgetUrl = document.getElementById("gadgetUrl").value;
  gadget.specUrl = gadgetUrl;
  goog.net.cookies.set(gadgetUrlCookie, encodeURIComponent(gadgetUrl));

  gadgets.container.renderGadgets();
};


SampleContainerGadget = function(opt_params) {
  gadgets.IfrGadget.call(this, opt_params);
};

SampleContainerGadget.inherits(gadgets.IfrGadget);

SampleContainerGadget.prototype.getIframeUrl = function() {
  var url = this.serverBase_ + 'ifr?url=' +
      encodeURIComponent(this.specUrl) + '&synd=' + this.SYND + '&mid=' +
      this.id + '&parent=' + encodeURIComponent(gadgets.container.parentUrl_) +
      '&ogc=' + document.location.host + this.getUserPrefsParams();
  if (useCaja) {
    url += "&caja=1";
  }
  if (!useCache) {
    url += "&nocache=1";
  }
  if (usePermissive) {
    url += "&usepermissive=1";
  }
  return url;
};
gadgets.container.gadgetClass = SampleContainerGadget;

</script>
</head>
<body onLoad="initGadget();">
  <div id="headerDiv">
    <div style="float:left">Gadget testing container</div>
    <div class="subTitle">
      Displaying gadget: <input type="text" size="75" id="gadgetUrl"/>
      <input type="checkbox" id="useCacheCheckbox" checked="true"/>use cache
      <input type="checkbox" id="useCajaCheckbox"/>use caja
      <input type="checkbox" id="usePermissiveCheckbox"/>use permissive

      <br/>

      Using state: <input type="text" size="75" id="stateFileUrl"/>
      <input type="checkbox" id="doEvilCheckbox" checked="true"/>do evil

      <br/>

      <input type="button" value="reset all" onclick="changeGadgetUrl();"/>
    </div>
    <div style="clear:both; height: 1px;">&nbsp;</div>
  </div>

  <div id="gadget-chrome" class="gadgets-gadget-chrome" style="width:80%;"></div>
</body>
</html>
